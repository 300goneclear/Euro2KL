
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Euro2KLeague — Team Leaders</title>
  <link rel="stylesheet" href="stats.css">
</head>
<body>
  <div class="wrapper">
    <div class="header">
      <div class="logo">E2K</div><h1>Stats</h1>
      <div class="subnav">
        <a href="leaders-players.html">Player Leaders</a>
        <a class="active" href="leaders-teams.html">Team Leaders</a>
      </div>
    </div>
    <div id="debug" class="debug" style="display:none"></div>
    <div class="section-title"><h2>Team Leaders</h2><span class="badge">BETA</span></div>
    <div class="grid">
      <div class="leaders" id="team-leaders"></div>
      <aside class="sidebar" id="sidebar-right"></aside>
    </div>
    <footer>Euro2KLeague — stats layout pack • Generated 2025-09-05</footer>
  </div>
  <script>
(() => {
  const DATA_PATHS = ['/Euro2KL/assets/data/boxscore.json', 'assets/data/boxscore.json', '/assets/data/boxscore.json'];
  const wrapper = document.querySelector('.wrapper');
  function debug(msg){ const d=document.querySelector('#debug')||(()=>{const div=document.createElement('div');div.id='debug';div.className='debug';wrapper.prepend(div);return div;})(); d.innerHTML += `<div>${msg}</div>`; }
  function renderEmpty(where, msg, det){ const div=document.createElement('div');div.className='empty';div.innerHTML = `<strong>${msg}</strong>${det?`<div class="kicker">${det}</div>`:''}`; where.appendChild(div); }
  function renderCard(where, title, rows){ const card=document.createElement('div'); card.className='card'; card.innerHTML=`<h3>${title}</h3><table class="table"><tbody></tbody></table>`; const tb=card.querySelector('tbody'); rows.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML = `<td class="rank">${i+1}.</td><td>${r.name}</td><td style="text-align:right;font-variant-numeric:tabular-nums">${r.val}</td>`; tb.appendChild(tr); }); where.appendChild(card); }
  const by = k => (a,b)=> (b[k]??0) - (a[k]??0);
  const round = (x,d=1)=> Number.parseFloat(x??0).toFixed(d);

  async function loadBox(){
    const tried=[];
    for(const url of DATA_PATHS){
      try{
        const r = await fetch(url, {cache:'no-store'});
        tried.push(`${url} → ${r.status}`);
        if(r.ok) { debug(`Loaded ${url}`); return await r.json(); }
      }catch(e){ tried.push(`${url} → ${e.message}`); }
    }
    throw new Error('Failed to load boxscore.json\n'+tried.join('\n'));
  }

  function sum(list, key){ return list.reduce((s,p)=> s + Number(p[key]||0), 0); }

  async function run(){
    const host = document.querySelector('#team-leaders');
    let data;
    try{ data = await loadBox(); }catch(e){ renderEmpty(host, 'Couldn’t load boxscore.json', e.message.replaceAll('\n','<br>')); return; }
    const game = data.game || data;
    const H = game.home || {}; const A = game.away || {};
    const nameH = H.name || H.team || H.abbr || H.id || 'Home';
    const nameA = A.name || A.team || A.abbr || A.id || 'Away';

    const lines = [
      {
        name: nameH,
        ppg: Number(H.score||H.points||0),
        rpg: Number(H.totals?.reb || 0) || sum(H.players||[], 'reb'),
        apg: Number(H.totals?.ast || 0) || sum(H.players||[], 'ast'),
        spg: Number(H.totals?.stl || 0) || sum(H.players||[], 'stl'),
        bpg: Number(H.totals?.blk || 0) || sum(H.players||[], 'blk')
      },
      {
        name: nameA,
        ppg: Number(A.score||A.points||0),
        rpg: Number(A.totals?.reb || 0) || sum(A.players||[], 'reb'),
        apg: Number(A.totals?.ast || 0) || sum(A.players||[], 'ast'),
        spg: Number(A.totals?.stl || 0) || sum(A.players||[], 'stl'),
        bpg: Number(A.totals?.blk || 0) || sum(A.players||[], 'blk')
      }
    ];

    const cats = [
      ['POINTS PER GAME','ppg',1],
      ['REBOUNDS PER GAME','rpg',1],
      ['ASSISTS PER GAME','apg',1],
      ['STEALS PER GAME','spg',1],
      ['BLOCKS PER GAME','bpg',1]
    ];

    for(const [label,key,dp] of cats){
      const top = [...lines].sort(by(key)).map(t=>({ name: t.name, val: round(t[key], dp) }));
      renderCard(host, label, top);
    }
  }

  run();
})();
</script>
</body>
</html>
