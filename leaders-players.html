<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Euro2KLeague — Player Leaders (games.json)</title>
  <link rel="stylesheet" href="stats.css">
</head><body>
<div class="wrapper">
  <div class="header">
    <div class="logo">E2K</div><h1>Stats</h1>
    <div class="subnav"><a class="active" href="leaders-players.html">Player Leaders</a><a href="leaders-teams.html">Team Leaders</a></div>
  </div>
  <div id="debug" class="debug" style="display:none"></div>
  <div class="section-title"><h2>Game Leaders</h2><span class="badge">GAMES.JSON</span></div>
  <div class="grid"><div class="leaders" id="player-leaders"></div><aside class="sidebar" id="sidebar-right"></aside></div>
  <footer>Euro2KLeague — reads games.json • Generated 2025-09-05</footer>
</div>
<script>
(() => {
  const QS = new URLSearchParams(location.search);
  const DEBUG = QS.has('debug');
  const BASES = ['/Euro2KL/assets/data','assets/data','/assets/data'];
  function dbg(msg){ if(!DEBUG) return; const d=document.getElementById('debug'); d.style.display='block'; d.innerHTML += `<div>${msg}</div>`; }
  function showEmpty(where,msg,det){ const div=document.createElement('div'); div.className='empty'; div.innerHTML = `<strong>${msg}</strong>${det?`<div class="kicker">${det}</div>`:''}`; where.appendChild(div); }

  async function tryFetchJSON(file){
    const tried = [];
    for(const base of BASES){
      const url = `${base.replace(/\/$/,'')}/${file.replace(/^\//,'')}`;
      try{ const r = await fetch(url, {cache:'no-store'}); dbg(`TRY ${url} → ${r.status}`); if(r.ok) return await r.json(); tried.push(`${url} → ${r.status}`); } catch(e){ tried.push(`${url} → ${e.message}`); dbg(`ERR ${url} → ${e.message}`); }
    }
    const err = new Error('All paths failed for '+file); err._tried = tried; throw err;
  }

  function pickLatestGame(raw){
    const arr = Array.isArray(raw) ? raw : (raw.games || raw.data || []);
    if(!arr.length) return null;
    // pick by date field, fallback to position 0
    const sorted = arr.slice().sort((a,b)=> Date.parse(b.date||b.gameDate||b.start_time||0) - Date.parse(a.date||a.gameDate||a.start_time||0));
    return sorted[0];
  }

  function renderCard(where, title, rows){
    const card=document.createElement('div'); card.className='card';
    card.innerHTML=`<h3>${title}</h3><table class="table"><tbody></tbody></table>`;
    const tb=card.querySelector('tbody');
    rows.forEach((r,i)=>{ const tr=document.createElement('tr'); tr.innerHTML=`<td class="rank">${i+1}.</td><td>${r.name}</td><td style="text-align:right;font-variant-numeric:tabular-nums">${r.val}</td>`; tb.appendChild(tr); });
    where.appendChild(card);
  }
  const by=k=>(a,b)=>(b[k]??0)-(a[k]??0);
  const round=(x,d=1)=> Number.parseFloat(x??0).toFixed(d);

  async function run(){
    const host=document.getElementById('player-leaders');
    // 1) try games.json (preferred)
    let rawGames = null;
    try{ rawGames = await tryFetchJSON('games.json'); dbg('Loaded games.json'); }
    catch(e){ dbg('games.json not available'); }
    let game = null;
    if(rawGames){ game = pickLatestGame(rawGames); }
    // 2) fallback to boxscore.json (legacy)
    if(!game){
      try{ const box = await tryFetchJSON('boxscore.json'); game = box.game || box; dbg('Loaded boxscore.json fallback'); }
      catch(e){ dbg('boxscore.json fallback failed'); }
    }
    if(!game){ showEmpty(host,'No games found in games.json or boxscore.json.','Upload games.json with games[] or a boxscore.json'); return; }

    const players = [].concat(game.home?.players||[], game.away?.players||[]);
    if(!players.length){ showEmpty(host,'No player arrays detected in the chosen game.','Expected home.players and away.players arrays.'); return; }

    const cats = [
      ['POINTS','pts',0],
      ['REBOUNDS','reb',0],
      ['ASSISTS','ast',0],
      ['STEALS','stl',0],
      ['BLOCKS','blk',0],
      ['3-PT MADE','tpm',0],
      ['FIELD GOAL %','fg',1, p => (p.fga? (100*(p.fgm||0)/p.fga).toFixed(1)+'%':'—')],
      ['3-PT %','tp',1, p => (p.tpa? (100*(p.tpm||0)/p.tpa).toFixed(1)+'%':'—')],
      ['FREE THROW %','ft',1, p => (p.fta? (100*(p.ftm||0)/p.fta).toFixed(1)+'%':'—')]
    ];
    for(const [label,key,dp,fmt] of cats){
      const top = [...players].sort(by(key)).slice(0,5).map(p=>({ name: p.gamertag||p.name||p.playerName||'—', val: fmt?fmt(p):round(p[key],dp) }));
      renderCard(host, label, top);
    }
  }

  run();
})();
</script>
</body></html>